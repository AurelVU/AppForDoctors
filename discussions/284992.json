[
  {
    "Id": "720481",
    "ThreadId": "284992",
    "Html": "\r\n<p>I have a large XLS file with one worksheet containing 8 columns and 18216 rows.</p>\r\n<p>When using the ExcelDataReader library I encountered the problem that unique strings are missing starting from row with index 11888.</p>\r\n<p>I use the library as described on this website:</p>\r\n<p>1. ExcelReaderFactory.CreateBinaryReader(stream);</p>\r\n<p>2.&nbsp;DataSet result = excelReader.AsDataSet();</p>\r\n<p>3. Take out table[0] and start iterating over all rows and print column values of each row.</p>\r\n<p>I debugged it a bit and pinpointed the problem has to be in the algorithm of the method:&nbsp;<strong>XlsBiffSST:ReadStrings\r\n</strong>because the method:&nbsp;<strong>XlsBiffSST:GetString </strong>returned string.empty due to the fact that the index was out of range of the m_strings array.</p>\r\n<p>Due to the fact that my knowledge of this lib is very low and the ReadStrings method is pretty complex I would like to ask if someone can take a look at this problem an come up with a fix.</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>public string GetString(uint SSTIndex)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>{</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>if (SSTIndex &lt; m_strings.Count)</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>return m_strings[(int)SSTIndex];</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>return string.Empty;</div>\r\n<div id=\"_mcePaste\" style=\"left:-10000px; top:0px; width:1px; height:1px; overflow-x:hidden; overflow-y:hidden\">\r\n<span style=\"white-space:pre\"></span>}</div>\r\n</div>\r\n",
    "PostedDate": "2012-01-04T13:32:49.523-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "852123",
    "ThreadId": "284992",
    "Html": "\r\n<p>I'm not sure if you ever got this fixed, but I had the same issue come up this week.&nbsp; I have commit version 59893.</p>\r\n<p>After a day of debugging, the problem for me appears to be the commented code in the HasExtString property of the XlsFormattedUnicodeString.cs file in the Code/BinaryFormat folder.&nbsp; Even when the cell should have an extended string, it was always returning\r\n false, causing value issues with any field that had an extended string.&nbsp; Once one of these was encountered, the rest of the file would be be read properly, and the offset would become greater than the last bit index, and return out of the ReadString method.&nbsp;\r\n Long story short, modifying the following code (starting at line 48 in Excel/Code/BinaryFormat/XlsFormattedUnicodeString.cs):</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>\t\t<span style=\"color:gray\">///</span> <span style=\"color:gray\">&lt;summary&gt;</span>\n\t\t<span style=\"color:gray\">///</span><span style=\"color:green\"> Checks if string has Extended record</span>\n\t\t<span style=\"color:gray\">///</span> <span style=\"color:gray\">&lt;/summary&gt;</span>\n\t\t<span style=\"color:blue\">public</span> <span style=\"color:blue\">bool</span> HasExtString\n\t\t{\n\t\t    <span style=\"color:blue\">get</span> { <span style=\"color:blue\">return</span> <span style=\"color:blue\">false</span>; }\n                    <span style=\"color:green\">// ((Flags &amp; FormattedUnicodeStringFlags.HasExtendedString) == FormattedUnicodeStringFlags.HasExtendedString); }</span>\n\t\t}\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>to be:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>\t\t<span style=\"color:gray\">///</span> <span style=\"color:gray\">&lt;summary&gt;</span>\n\t\t<span style=\"color:gray\">///</span><span style=\"color:green\"> Checks if string has Extended record</span>\n\t\t<span style=\"color:gray\">///</span> <span style=\"color:gray\">&lt;/summary&gt;</span>\n\t\t<span style=\"color:blue\">public</span> <span style=\"color:blue\">bool</span> HasExtString\n\t\t{\n\t\t    <span style=\"color:green\">//get { return false; }</span>\n                    <span style=\"color:blue\">get</span> { <span style=\"color:blue\">return</span> ((Flags &amp; FormattedUnicodeStringFlags.HasExtendedString) == FormattedUnicodeStringFlags.HasExtendedString); }\n\t\t}\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>resolved the issue for me.&nbsp; Hopefully this saves some headaches for somebody else down the road.</p>\r\n",
    "PostedDate": "2012-06-21T07:12:14.313-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1106599",
    "ThreadId": "284992",
    "Html": "Sadly I just spent a day of debugging on this as well. Found that commented out flag test and had a WTF moment. \r<br />\n<br />\nUn-commented the test ( after learning way too much about BIFF record structures ) and my failing spreadsheets all work.\r<br />\n<br />\nI don't have SVN install anymore, and can't make a SVN patch for this. If someone reads this, please make a patch to enable the flag test and submit it to the devs.<br />\n",
    "PostedDate": "2013-10-11T14:59:10.82-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]