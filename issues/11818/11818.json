{
  "WorkItem": {
    "AffectedComponent": {
      "Name": "",
      "DisplayName": ""
    },
    "ClosedComment": "",
    "ClosedDate": "2014-01-29T08:14:46.297-08:00",
    "CommentCount": 0,
    "Custom": null,
    "Description": "I'm trying to read the attached file. I'm getting the following error.\n\nxlDataSet = xlReader.AsDataSet();\nIndex was out of range. Must be non-negative and less than the size of the collection.\nParameter name: index\n\nThe file appears to be valid, when I open the file in excel and save it again the same code works without a problem.",
    "LastUpdatedDate": "2017-11-27T20:47:32.087-08:00",
    "PlannedForRelease": "",
    "ReleaseVisibleToPublic": false,
    "Priority": {
      "Name": "Unassigned",
      "Severity": 0,
      "Id": 0
    },
    "ProjectName": "ExcelDataReader",
    "ReportedDate": "2013-05-28T07:40:50.417-07:00",
    "Status": {
      "Name": "Closed",
      "Id": 4
    },
    "ReasonClosed": {
      "Name": "Unassigned"
    },
    "Summary": "Error loading file",
    "Type": {
      "Name": "Unassigned",
      "Id": 5
    },
    "VoteCount": 2,
    "Id": 11818
  },
  "FileAttachments": [
    {
      "FileId": 4554,
      "FileName": "problemfile.xls",
      "DownloadUrl": ".\\4554"
    },
    {
      "FileId": 4628,
      "FileName": "R20501.xls",
      "DownloadUrl": ".\\4628"
    }
  ],
  "Comments": [
    {
      "Message": "Where did the file come from?",
      "PostedDate": "2013-05-29T08:29:55.217-07:00",
      "Id": -2147483648
    },
    {
      "Message": "It is generated by an external report generator, I don't have any more details on this.  \nThey only thing it can generate is this kind of files. \n",
      "PostedDate": "2013-05-30T00:01:24.003-07:00",
      "Id": -2147483648
    },
    {
      "Message": "",
      "PostedDate": "2013-08-20T21:23:29.827-07:00",
      "Id": -2147483648
    },
    {
      "Message": "Hi Ian,\r\n\r\nI too am facing the same exception when calling the AsDataSet() method on some specific files(example attached). The excel file is generated by SQL Server Reporting services.\r\n\r\nCode:\n```\nFileStream streamExcelBase = File.Open(excelPath, FileMode.Open, FileAccess.Read);\nIExcelDataReader excelReaderBase = ExcelReaderFactory.CreateBinaryReader(streamExcelBase, ReadOption.Loose);\r\n\r\nDataSet reportDataset = excelReaderBase.AsDataSet();\r\n\r\n```\r\n\r\nException details:\r\n\r\n```\nSystem.ArgumentOutOfRangeException was unhandled\n  HResult=-2146233086\n  Message=Index was out of range. Must be non-negative and less than the size of the collection.\nParameter name: startIndex\n  Source=mscorlib\n  ParamName=startIndex\n  StackTrace:\n       at System.ThrowHelper.ThrowArgumentOutOfRangeException(ExceptionArgument argument, ExceptionResource resource)\n       at System.BitConverter.ToUInt16(Byte[] value, Int32 startIndex)\n       at Excel.Core.BinaryFormat.XlsBiffRecord.GetRecord(Byte[] bytes, UInt32 offset, ExcelBinaryReader reader)\n       at Excel.Core.BinaryFormat.XlsBiffStream.ReadAt(Int32 offset)\n       at Excel.ExcelBinaryReader.findFirstDataCellOffset(Int32 startOffset)\n       at Excel.ExcelBinaryReader.readWholeWorkSheetWithIndex(XlsBiffIndex idx, Boolean triggerCreateColumns, DataTable table)\n       at Excel.ExcelBinaryReader.readWholeWorkSheet(XlsWorksheet sheet)\n       at Excel.ExcelBinaryReader.AsDataSet(Boolean convertOADateTime)\n       at Excel.ExcelBinaryReader.AsDataSet()\n       at CommPayTestInfra.Common.ExcelCompareHelper.GetDataSetFromExcelFile(String excelPath) in ..<clipped>\n```",
      "PostedDate": "2013-08-20T21:23:35.747-07:00",
      "Id": -2147483648
    },
    {
      "Message": "",
      "PostedDate": "2013-08-20T21:26:50.15-07:00",
      "Id": -2147483648
    },
    {
      "Message": "I faced the same error so i included those 4 lines: \r\n\r\nFirst:\n```\n \t\t\tif ((uint) m_offset >= bytes.Length)\n \t\t\t\treturn null;\n```\nSecound:\n```\n\t\t\tif ((uint)offset >= bytes.Length)\n\t\t\t\treturn null;\n```\r\n\r\n\r\n\r\n```\r\n\r\n\t\t/// <summary>\n\t\t/// Reads record under cursor and advances cursor position to next record\n\t\t/// </summary>\n\t\t/// <returns></returns>\n\t\t[MethodImpl(MethodImplOptions.Synchronized)]\n\t\tpublic XlsBiffRecord Read()\n\t\t{\n \t\t\tif ((uint) m_offset >= bytes.Length)\n \t\t\t\treturn null;\n\t\t\tXlsBiffRecord rec = XlsBiffRecord.GetRecord(bytes, (uint)m_offset);\n\t\t\tm_offset += rec.Size;\n\t\t\tif (m_offset > m_size)\n\t\t\t\treturn null;\n\t\t\treturn rec;\n\t\t}\r\n\r\n\t\t/// <summary>\n\t\t/// Reads record at specified offset, does not change cursor position\n\t\t/// </summary>\n\t\t/// <param name=\"offset\"></param>\n\t\t/// <returns></returns>\n\t\tpublic XlsBiffRecord ReadAt(int offset)\n\t\t{\n\t\t\tif ((uint)offset >= bytes.Length)\n\t\t\t\treturn null;\n\t\t\tXlsBiffRecord rec = XlsBiffRecord.GetRecord(bytes, (uint)offset);\n\t\t\tif (m_offset + rec.Size > m_size)\n\t\t\t\treturn null;\n\t\t\treturn rec;\n\t\t}\n```\r\n\r\nit temporaly solved the error...",
      "PostedDate": "2014-01-28T00:19:02.57-08:00",
      "Id": -2147483648
    },
    {
      "Message": "",
      "PostedDate": "2014-01-29T08:04:04.43-08:00",
      "Id": -2147483648
    },
    {
      "Message": "Resolved with changeset 87191.",
      "PostedDate": "2014-01-29T08:14:46.297-08:00",
      "Id": -2147483648
    },
    {
      "Message": "",
      "PostedDate": "2017-11-27T20:47:32.087-08:00",
      "Id": -2147483648
    }
  ]
}